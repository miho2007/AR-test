<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR.js + VR Passthrough Fix</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.7/aframe/build/aframe-ar.js"></script>
  <style>
    html, body { margin:0; padding:0; overflow:hidden; width:100%; height:100%; background:black; }
  </style>
</head>
<body>
  <a-scene
    embedded
    renderer="antialias: true; alpha: true"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    vr-mode-ui="enabled: true"
  >

    <!-- Background plane that shows live camera texture -->
    <a-assets>
      <video id="camFeed" autoplay playsinline webkit-playsinline muted></video>
    </a-assets>

    <a-entity id="bgPlane" geometry="primitive: plane; height: 2; width: 2"
              position="0 0 -1"
              material="shader: flat; src: #camFeed;"></a-entity>

    <!-- AR marker -->
    <a-marker preset="hiro">
      <a-box position="0 0.5 0" rotation="0 45 0" color="red"></a-box>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // Force manual camera feed
    const video = document.getElementById('camFeed');

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(stream => {
        video.srcObject = stream;
        video.play();
        console.log("âœ… Camera stream active");

        // Once ready, update the plane scale to fit view
        video.addEventListener('loadedmetadata', () => {
          const aspect = video.videoWidth / video.videoHeight;
          const plane = document.getElementById('bgPlane');
          plane.setAttribute('geometry', {
            primitive: 'plane',
            height: 2,
            width: 2 * aspect
          });
        });
      })
      .catch(err => {
        console.error("ðŸš« Camera access error:", err);
      });
  </script>
</body>
</html>
